<!DOCTYPE html>

<link rel="stylesheet" href="./css/global.css">

<head>
    <style>
      .profile {
        height: 220px;  
        width: 560px;
        margin: auto;
        background-color: #f0e6e9;
        border-radius: 30px;
        display: flex;
      }
      .profile img {
        height: 50%;
        align-self: center;
        margin: 10px 30px;
      }
      .profile_text {
        height: 100%;  
        width: 50%;
        margin: 20px 0;  
      }
      .profile_text h3 {
        text-align: center;
        margin: 0 0 8px 0; 
        font-size: 20px;  
      }
      .profile_text p {
        margin: 6px 0;  
        line-height: 1.2;
      }
      .status_text {
        display: grid; 
        width: 300px;
        grid-template-columns: 1fr 1fr;
        gap: 0px 20px; 
      }
      .status_text p {
        font-size: 18px;
      }
      .edit_btn {
        margin: 10px;
        height: 40px;
        width: 100px;
        border-radius: 30px;
        border-color: transparent;
        align-self: self-end;
        background-color: #bdd8a1;
        display: flex; 
        justify-content: center; 
        align-items: center; 
        text-align: center;
        font-size: 18px;
      }

    .shortcut_container {
        height: 150px;
        width: 560px;
        margin: auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .shortcut {
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .shortcut p {
        margin-top: 8px;
        font-size: 18px;
        text-align: center;
    }

    .new_workout, .past_workout, .meals {
        height: 150px;
        width: 150px;
        background-color: #f0e6e9;
        border-radius: 30px;
        transition: background-color 0.3s ease;
    }

    .new_workout:hover, .past_workout:hover, .meals:hover {
        background-color: #b0a6a6;
    }

    .graph {
        height: 204px;
        width: 560px;
        margin: auto;
        margin-top: -20px;
        background-color: #f0e6e9;
        border-radius: 30px;
        padding: 15px;
        box-sizing: border-box;
    }
    
    .tracking-summary {
        display: flex;
        flex-direction: column;
        height: 100%;
    }
    
    .tracking-widget {
        display: flex;
        flex-direction: row;
        height: 100%;
        gap: 15px;
    }
    
    .widget-column {
        flex: 1;
        display: flex;
        flex-direction: column;
    }
    
    .summary-section {
        background-color: #fff6f4;
        border-radius: 15px;
        padding: 10px;
        flex: 1;
        height: 100%;
        display: flex;
        flex-direction: column;
    }
    
    .breakdown-section {
        background-color: #fff6f4;
        border-radius: 15px;
        padding: 10px;
        overflow: hidden;
        flex: 1;
        height: 100%;
        display: flex;
        flex-direction: column;
    }
    
    .summary-content {
        flex: 1;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
    }
    
    .active-days-container {
        margin-top: 10px;
    }
    
    .active-days-label {
        font-size: 20px;
        margin-bottom: 3px;
        color: #666;
    }
    
    .active-days {
        background-color: #bdd8a1;
        height: 10px;
        border-radius: 5px;
        position: relative;
    }
    
    .active-days-fill {
        background-color: #7fa85e;
        height: 100%;
        border-radius: 5px;
    }
    
    .workout-count, .meal-count {
        font-weight: bold;
        color: #333;
    }
    
    .empty-tracking {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100%;
        color: #666;
    }
    
    .day-summary-container {
        display: flex;
        flex-direction: column;
        flex: 1;
    }
    
    .day-summary {
        font-size: 14px;
        margin-bottom: 5px;
        display: flex;
        justify-content: space-between;
    }
    
    .day-name {
        font-weight: bold;
        color: #444;
    }
    
    .day-stats {
        color: #666;
    }
    
    .summary-stat {
        display: flex;
        align-items: center;
        margin-bottom: 5px;
        font-size: 20px;
        color: #444;
    }
    
    .stat-icon {
        width: 16px;
        height: 16px;
        display: inline-block;
        margin-right: 5px;
        background-color: #bdd8a1;
        border-radius: 50%;
    }
    
    .meal-icon {
        background-color: #f9f4b2;
    }
    
    .summary-title {
        font-weight: bold;
        margin-bottom: 8px;
        color: #444;
    }

    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        justify-content: center;
        align-items: center;
    }

    .modal-content {
        background: #f0e6e9;
        padding: 20px;
        border-radius: 8px;
        width: 300px;
        text-align: center;
        position: relative;
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
    }

    .close {
        position: absolute;
        top: 10px;
        right: 15px;
        font-size: 20px;
        cursor: pointer;
    }
    
    .shortcut img {
        display: block;
        margin-left: auto;
        margin-right: auto;
        margin-top: 20px;
        height: 110px;
        width: 110px;
    }

    .shortcut a {
        position: absolute;
        display: block;
        height: 150px;
        width: 150px;
        top: 315px; /* jank but we'll roll with it */
        z-index: 3;
        font-size: 0;
        align-content: center;
    }

    select {
        width: 100%;
        padding: 10px;
        margin: 10px 0;
        border: 1px solid black;
        border-radius: 5px;
        font-size: 16px;
        background-color: #fff6f4;
    }

    select:focus {
        border-color: #bdd8a1;
        outline: none;
    }

    input[type="number"] {
        width: 280px; 
        padding: 10px; 
        margin: 10px 0; 
        border: 1px solid black; 
        border-radius: 5px; 
        font-size: 16px; 
        background-color: #fff6f4; 
    }

    input[type="number"]:focus {
        border-color: #bdd8a1;
        outline: none; 
    }

    label {
        font-weight: bold;
        display: block;
        margin-top: 10px;
        text-align: left;
    }
    #saveButton {
        background-color: #fff6f4;
        border: 1px solid black;
        border-radius: 10px;
    }

    body.modal-open {
        pointer-events: none; 
    }

    .modal {
        pointer-events: auto; 
    }
    </style>
</head>

<html>
    <body>
        <div class="device">
            <h1>Home</h1>
            <div class="profile">
                <img src="./resources/images/homepage/profile_icon.png" alt="">
                <div class="profile_text">
                    <h3>Welcome User!</h3>
                    <div class="status_text">
                        <p>Experience: <span id="experience">Unknown</span></p>
                        <p>Age: <span id="age">Unknown</span></p>
                        <p>Weight: <span id="weight">Unknown</span></p>
                        <p>Height: <span id="height">Unknown</span></p>
                        <p>Gender: <span id="gender">Unknown</span></p>
                    </div> 
                </div>
                <button class="edit_btn">Edit</button>
            </div>
            

            <h2>Shortcuts</h2>
            <!-- the text for anchor links will just be set to font-size: 0-->
            <div class="shortcut_container">
                <div class="shortcut">
                    <div class="new_workout">
                        <img src="./resources/images/homepage/new_workout.png">
                        <a href="./html/planning.html">New Workout</a>
                    </div>
                    <p>New Workout</p>
                </div>
                <div class="shortcut">
                    <div class="past_workout">
                        <img src="./resources/images/homepage/past_workouts.png">
                        <a href="./html/tracking.html">Past Workout</a>
                    </div>
                    <p>Past Workouts</p>
                </div>
                <div class="shortcut">
                    <div class="meals">
                        <img src="./resources/images/homepage/meals.png">
                        <a href="./html/tracking.html">Meals</a>
                    </div>
                    <p>Meals</p>
                </div>
            </div>

            <h2>Quick Look</h2>
            <div class="graph">
                <div id="tracking-summary" class="tracking-summary">
                    <!-- Tracking summary will be inserted here by JavaScript -->
                </div>
            </div>

            <div class="bottom-nav">
                <div class="active">
                    <img src="./resources/images/navbar/home.png">
                    <a href="./index.html">Home</a>
                </div>
                <div class="inactive">
                    <img src="./resources/images/navbar/planning.png">
                    <a href="./html/planning.html">Planning</a>
                </div>
                <div class="inactive">
                    <img src="./resources/images/navbar/workout.png">
                    <a href="./html/workout.html">Workout</a>
                </div>
                <div class="inactive">
                    <img src="./resources/images/navbar/tracking.png">
                    <a href="./html/tracking.html">Tracking</a>
                </div>
                <div class="inactive">
                    <img src="./resources/images/navbar/goals.png">
                    <a href="./html/goals.html">Goals</a>
                </div>
            </div>
        </div>

        <div id="modal" class="modal">
            <div class="modal-content">
                <span class="close">x</span>
                <h3>Edit Profile</h2>
                <label for="experienceInput">Experience:</label>
                <select id="experienceInput">
                    <option value="Beginner">Beginner(New)</option>
                    <option value="Intermediate">Intermediate(1-3 Years)</option>
                    <option value="Advanced">Advanced(3+ Years)</option>
                </select>

                <label for="ageInput">Age (years):</label>
                <input type="number" id="ageInput" placeholder="Enter your age" min="1" max="120" step="1">

                <label for="weightInput">Weight (lbs):</label>
                <input type="number" id="weightInput" placeholder="Enter your weight" min="1" max="999" step="1">

                <label for="heightInput">Height (inches):</label>
                <input type="number" id="heightInput" placeholder="Enter your height in inches" min="36" max="96" step="1">

                <label for="genderInput">Gender:</label>
                <select id="genderInput">
                    <option value="Male">Male</option>
                    <option value="Female">Female</option>
                    <option value="Other">Other</option>
                </select>
                
                <button id="saveButton">Save</button>
            </div>
        </div>

        <script>
            document.addEventListener("DOMContentLoaded", function () {
                const modal = document.getElementById("modal");
                const editButton = document.querySelector(".edit_btn");
                const closeButton = document.querySelector(".close");
                const saveButton = document.getElementById("saveButton");

                const experienceSpan = document.getElementById("experience");
                const ageSpan = document.getElementById("age");
                const weightSpan = document.getElementById("weight");
                const heightSpan = document.getElementById("height");
                const genderSpan = document.getElementById("gender");

                const experienceInput = document.getElementById("experienceInput");
                const ageInput = document.getElementById("ageInput");
                const weightInput = document.getElementById("weightInput");
                const heightInput = document.getElementById("heightInput");
                const genderInput = document.getElementById("genderInput");

                const savedData = JSON.parse(localStorage.getItem('profileData') || '{}');
                

                if (savedData.experience) {
                    experienceInput.value = savedData.experience;
                    experienceSpan.textContent = savedData.experience;
                }
                if (savedData.age) {
                    ageInput.value = savedData.age;
                    ageSpan.textContent = savedData.age + " yrs";
                }
                if (savedData.weight) {
                    weightInput.value = savedData.weight;
                    weightSpan.textContent = savedData.weight + " lbs";
                }
                if (savedData.height) {
                    heightInput.value = savedData.height;
                    const feet = Math.floor(savedData.height / 12);
                    const inches = savedData.height % 12;
                    heightSpan.textContent = `${feet}'${inches}"`;
                }
                if (savedData.gender) {
                    genderInput.value = savedData.gender;
                    genderSpan.textContent = savedData.gender;
                }

                editButton.addEventListener("click", function () {
                    modal.style.display = "flex";
                    document.body.classList.add("modal-open"); 
                });

                closeButton.addEventListener("click", function () {
                    modal.style.display = "none";
                    document.body.classList.remove("modal-open"); 
                });

                saveButton.addEventListener("click", function () {
                    const profileData = {
                        experience: experienceInput.value,
                        age: ageInput.value,
                        weight: weightInput.value,
                        height: heightInput.value,
                        gender: genderInput.value
                    };
                    localStorage.setItem('profileData', JSON.stringify(profileData));

                    experienceSpan.textContent = experienceInput.value;

                    if (ageInput.value.trim() === "") {
                        ageSpan.textContent = "Unknown";
                    } else {
                        ageSpan.textContent = ageInput.value + " yrs";
                    }

                    if (weightInput.value.trim() === "") {
                        weightSpan.textContent = "Unknown";
                    } else {
                        weightSpan.textContent = weightInput.value + " lbs";
                    }

                    const totalInches = parseInt(heightInput.value, 10);
                    if (!isNaN(totalInches) && heightInput.value.trim() !== "") {
                        const feet = Math.floor(totalInches / 12);
                        const inches = totalInches % 12;
                        heightSpan.textContent = `${feet}'${inches}"`;
                    } else {
                        heightSpan.textContent = "Unknown";
                    }

                    genderSpan.textContent = genderInput.value;

                    modal.style.display = "none";
                    document.body.classList.remove("modal-open");
                });
                
                // New code to populate tracking summary
                function updateTrackingSummary() {
                    const trackingSummaryElement = document.getElementById('tracking-summary');
                    
                    let dayData;
                    try {
                        // Safely parse the localStorage data
                        const storedData = localStorage.getItem('dayData');
                        dayData = storedData ? JSON.parse(storedData) : {
                            Sun: { pastWeek: [], meals: [] },
                            Mon: { pastWeek: [], meals: [] },
                            Tue: { pastWeek: [], meals: [] },
                            Wed: { pastWeek: [], meals: [] },
                            Thu: { pastWeek: [], meals: [] },
                            Fri: { pastWeek: [], meals: [] },
                            Sat: { pastWeek: [], meals: [] }
                        };
                    } catch (e) {
                        // Fallback if JSON parsing fails
                        console.error('Error parsing tracking data:', e);
                        dayData = {
                            Sun: { pastWeek: [], meals: [] },
                            Mon: { pastWeek: [], meals: [] },
                            Tue: { pastWeek: [], meals: [] },
                            Wed: { pastWeek: [], meals: [] },
                            Thu: { pastWeek: [], meals: [] },
                            Fri: { pastWeek: [], meals: [] },
                            Sat: { pastWeek: [], meals: [] }
                        };
                    }
                    
                    let totalWorkouts = 0;
                    let totalMeals = 0;
                    let daysWithData = 0;
                    
                    // Count workouts and meals
                    const daysOfWeek = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
                    const activeDays = {};
                    
                    daysOfWeek.forEach(day => {
                        if (dayData[day]) {
                            const workouts = dayData[day].pastWeek ? dayData[day].pastWeek.length : 0;
                            const meals = dayData[day].meals ? dayData[day].meals.length : 0;
                            
                            totalWorkouts += workouts;
                            totalMeals += meals;
                            
                            activeDays[day] = {
                                workouts: workouts,
                                meals: meals,
                                hasActivity: workouts > 0 || meals > 0
                            };
                            
                            if (workouts > 0 || meals > 0) {
                                daysWithData++;
                            }
                        }
                    });
                    
                    if (daysWithData === 0) {
                        trackingSummaryElement.innerHTML = `
                            <div class="empty-tracking">
                                <p>No tracking data available yet.</p>
                                <p>Your workouts and meals will appear here.</p>
                            </div>
                        `;
                        return;
                    }
                    
                    // Get the active days with most activity for display (limit to 3 for space)
                    const activeDaysSorted = daysOfWeek
                        .filter(day => activeDays[day] && activeDays[day].hasActivity)
                        .sort((a, b) => {
                            const aTotal = activeDays[a].workouts + activeDays[a].meals;
                            const bTotal = activeDays[b].workouts + activeDays[b].meals;
                            return bTotal - aTotal;
                        })
                        .slice(0, 3);
                    
                    let summaryHTML = `
                        <div class="tracking-widget">
                            <div class="widget-column">
                                <div class="summary-section">
                                    <div class="summary-title">Weekly Overview</div>
                                    <div class="summary-content">
                                        <div>
                                            <div class="summary-stat">
                                                <span class="stat-icon"></span>
                                                <span>${totalWorkouts} workout${totalWorkouts !== 1 ? 's' : ''}</span>
                                            </div>
                                            <div class="summary-stat">
                                                <span class="stat-icon meal-icon"></span>
                                                <span>${totalMeals} meal${totalMeals !== 1 ? 's' : ''}</span>
                                            </div>
                                        </div>
                                        <div class="active-days-container">
                                            <div class="active-days-label">Active: ${daysWithData} of 7 days</div>
                                            <div class="active-days">
                                                <div class="active-days-fill" style="width: ${(daysWithData/7)*100}%"></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="widget-column">
                                <div class="breakdown-section">
                                    <div class="summary-title">Most Active Days</div>
                                    <div class="day-summary-container">
                    `;
                    
                    // Add most active days
                    activeDaysSorted.forEach(day => {
                        const workouts = activeDays[day].workouts;
                        const meals = activeDays[day].meals;
                        
                        summaryHTML += `
                            <div class="day-summary">
                                <span class="day-name">${day}</span>
                                <span class="day-stats">${workouts} workout${workouts !== 1 ? 's' : ''}, ${meals} meal${meals !== 1 ? 's' : ''}</span>
                            </div>
                        `;
                    });
                    
                    // If we have fewer than 3 active days, we don't need to fill with empty space
                    // since we're using a column layout
                    
                    summaryHTML += `
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    trackingSummaryElement.innerHTML = summaryHTML;
                }
                
                // Update tracking summary when page loads
                updateTrackingSummary();
            });
        </script>
    </body>

</html>